!function(){var e,t;e=this,t=function(e,t,s){"use strict";e.MD2Character=class{constructor(){this.scale=1,this.animationFPS=6,this.root=new t.Object3D,this.meshBody=null,this.meshWeapon=null,this.skinsBody=[],this.skinsWeapon=[],this.weapons=[],this.activeAnimation=null,this.mixer=null,this.onLoadComplete=function(){},this.loadCounter=0}loadParts(e){const i=this;function o(e,s){const i=new t.MeshLambertMaterial({color:16755200,wireframe:!0}),o=new t.MeshLambertMaterial({color:16777215,wireframe:!1,map:s}),n=new t.Mesh(e,o);return n.rotation.y=-Math.PI/2,n.castShadow=!0,n.receiveShadow=!0,n.materialTexture=o,n.materialWireframe=i,n}function n(e,s){const i=new t.TextureLoader,o=[];for(let n=0;n<s.length;n++)o[n]=i.load(e+s[n],a),o[n].mapping=t.UVMapping,o[n].name=s[n],o[n].encoding=t.sRGBEncoding;return o}function a(){i.loadCounter-=1,0===i.loadCounter&&i.onLoadComplete()}this.loadCounter=2*e.weapons.length+e.skins.length+1;const h=[];for(let t=0;t<e.weapons.length;t++)h[t]=e.weapons[t][1];this.skinsBody=n(e.baseUrl+"skins/",e.skins),this.skinsWeapon=n(e.baseUrl+"skins/",h);const r=new s.MD2Loader;r.load(e.baseUrl+e.body,(function(e){const s=new t.Box3;s.setFromBufferAttribute(e.attributes.position),i.root.position.y=-i.scale*s.min.y;const n=o(e,i.skinsBody[0]);n.scale.set(i.scale,i.scale,i.scale),i.root.add(n),i.meshBody=n,i.meshBody.clipOffset=0,i.activeAnimationClipName=n.geometry.animations[0].name,i.mixer=new t.AnimationMixer(n),a()}));const m=function(e,t){return function(s){const n=o(s,i.skinsWeapon[e]);n.scale.set(i.scale,i.scale,i.scale),n.visible=!1,n.name=t,i.root.add(n),i.weapons[e]=n,i.meshWeapon=n,a()}};for(let t=0;t<e.weapons.length;t++)r.load(e.baseUrl+e.weapons[t][0],m(t,e.weapons[t][0]))}setPlaybackRate(e){this.mixer.timeScale=0!==e?1/e:0}setWireframe(e){e?(this.meshBody&&(this.meshBody.material=this.meshBody.materialWireframe),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialWireframe)):(this.meshBody&&(this.meshBody.material=this.meshBody.materialTexture),this.meshWeapon&&(this.meshWeapon.material=this.meshWeapon.materialTexture))}setSkin(e){this.meshBody&&!1===this.meshBody.material.wireframe&&(this.meshBody.material.map=this.skinsBody[e])}setWeapon(e){for(let e=0;e<this.weapons.length;e++)this.weapons[e].visible=!1;const t=this.weapons[e];t&&(t.visible=!0,this.meshWeapon=t,this.syncWeaponAnimation())}setAnimation(e){if(this.meshBody){this.meshBody.activeAction&&(this.meshBody.activeAction.stop(),this.meshBody.activeAction=null);const t=this.mixer.clipAction(e,this.meshBody);t&&(this.meshBody.activeAction=t.play())}this.activeClipName=e,this.syncWeaponAnimation()}syncWeaponAnimation(){const e=this.activeClipName;if(this.meshWeapon){this.meshWeapon.activeAction&&(this.meshWeapon.activeAction.stop(),this.meshWeapon.activeAction=null);const t=this.mixer.clipAction(e,this.meshWeapon);t&&(this.meshWeapon.activeAction=t.syncWith(this.meshBody.activeAction).play())}}update(e){this.mixer&&this.mixer.update(e)}},Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("../loaders/MD2Loader.js")):"function"==typeof define&&define.amd?define(["exports","three","../loaders/MD2Loader"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE,e.THREE)}();
