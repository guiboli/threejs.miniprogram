!function(){var e,t;e=this,t=function(e,t){"use strict";function i(e,i,s){const h=this;this.volume=e,i=i||0,Object.defineProperty(this,"index",{get:function(){return i},set:function(e){return i=e,h.geometryNeedsUpdate=!0,i}}),this.axis=s||"z",this.canvas=document.createElement("canvas"),this.canvasBuffer=document.createElement("canvas"),this.updateGeometry();const a=new t.Texture(this.canvas);a.minFilter=t.LinearFilter,a.wrapS=a.wrapT=t.ClampToEdgeWrapping;const n=new t.MeshBasicMaterial({map:a,side:t.DoubleSide,transparent:!0});this.mesh=new t.Mesh(this.geometry,n),this.mesh.matrixAutoUpdate=!1,this.geometryNeedsUpdate=!0,this.repaint()}i.prototype={constructor:i,repaint:function(){this.geometryNeedsUpdate&&this.updateGeometry();const e=this.iLength,t=this.jLength,i=this.sliceAccess,s=this.volume,h=this.canvasBuffer,a=this.ctxBuffer,n=a.getImageData(0,0,e,t),r=n.data,o=s.data,c=s.upperThreshold,d=s.lowerThreshold,l=s.windowLow,p=s.windowHigh;let m=0;if("label"===s.dataType)for(let s=0;s<t;s++)for(let t=0;t<e;t++){let e=o[i(t,s)];e=e>=this.colorMap.length?e%this.colorMap.length+1:e;const h=this.colorMap[e];r[4*m]=h>>24&255,r[4*m+1]=h>>16&255,r[4*m+2]=h>>8&255,r[4*m+3]=255&h,m++}else for(let s=0;s<t;s++)for(let t=0;t<e;t++){let e=o[i(t,s)],h=255;h=c>=e&&d<=e?h:0,e=Math.floor(255*(e-l)/(p-l)),e=e>255?255:e<0?0:0|e,r[4*m]=e,r[4*m+1]=e,r[4*m+2]=e,r[4*m+3]=h,m++}a.putImageData(n,0,0),this.ctx.drawImage(h,0,0,e,t,0,0,this.canvas.width,this.canvas.height),this.mesh.material.map.needsUpdate=!0},updateGeometry:function(){const e=this.volume.extractPerpendicularPlane(this.axis,this.index);this.sliceAccess=e.sliceAccess,this.jLength=e.jLength,this.iLength=e.iLength,this.matrix=e.matrix,this.canvas.width=e.planeWidth,this.canvas.height=e.planeHeight,this.canvasBuffer.width=this.iLength,this.canvasBuffer.height=this.jLength,this.ctx=this.canvas.getContext("2d"),this.ctxBuffer=this.canvasBuffer.getContext("2d"),this.geometry&&this.geometry.dispose(),this.geometry=new t.PlaneGeometry(e.planeWidth,e.planeHeight),this.mesh&&(this.mesh.geometry=this.geometry,this.mesh.matrix.identity(),this.mesh.applyMatrix4(this.matrix)),this.geometryNeedsUpdate=!1}},e.VolumeSlice=i,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE)}();
