!function(){var e,t;e=this,t=function(e,t,n){"use strict";function a(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var a=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,a.get?a:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var r=a(n);const o=new TextEncoder;function i(e){return e}function u(e,t){let n=0,a=Math.floor((e.length+1)/2),o=0;const i=e.length-1;for(;!(o>i||(t[n++]=e[o++],o>i));)t[a++]=e[o++];let u=t[0];for(let e=1;e<t.length;e++){const n=t[e]-u+384;u=t[e],t[e]=n}return void 0===r&&console.error("THREE.EXRLoader: External `fflate.module.js` required"),r.zlibSync(t)}function l(e,t,n,a,r){e.r=t,e.g=n,e.b=a,e.a=r}function s(e,t,n){e.setUint8(n.value,t),n.value+=1}function c(e,t,n){e.setUint32(n.value,t,!0),n.value+=4}function d(e,n,a){e.setUint16(a.value,t.DataUtils.toHalfFloat(n),!0),a.value+=2}function f(e,t,n){e.setFloat32(n.value,t,!0),n.value+=4}function p(e,t,n){e.setBigUint64(n.value,BigInt(t),!0),n.value+=8}function h(e,t,n){const a=o.encode(t+"\0");for(let t=0;t<a.length;++t)s(e,a[t],n)}function y(e,t){return function(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}(e[t])}function m(e,t){return e[t]}e.EXRExporter=class{parse(e,n,a){if(!function(e,n){return e&&e.isWebGLRenderer?n&&n.isWebGLRenderTarget?n.texture.type!==t.FloatType&&n.texture.type!==t.HalfFloatType?(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget texture type."),!1):n.texture.format===t.RGBAFormat||(console.error("EXRExporter.parse: Unsupported WebGLRenderTarget texture format, expected RGBAFormat."),!1):(console.error("EXRExporter.parse: Unsupported second parameter, expected instance of WebGLRenderTarget."),!1):(console.error("EXRExporter.parse: Unsupported first parameter, expected instance of WebGLRenderer."),!1)}(e,n))return;const r=function(e,n={}){const a={0:1,2:1,3:16},r=e.width,o=e.height,i=e.texture.type,u=e.texture.format,l=e.texture.encoding,s=void 0!==n.compression?n.compression:3,c=(void 0!==n.type?n.type:t.HalfFloatType)===t.FloatType?2:1,d=a[s],f=4;return{width:r,height:o,type:i,format:u,encoding:l,compression:s,blockLines:d,dataType:c,dataSize:2*c,numBlocks:Math.ceil(o/d),numInputChannels:4,numOutputChannels:f}}(n,a),o=function(e,n,a){let r;return r=a.type===t.FloatType?new Float32Array(a.width*a.height*a.numInputChannels):new Uint16Array(a.width*a.height*a.numInputChannels),e.readRenderTargetPixels(n,0,0,a.width,a.height,r),r}(e,n,r),g=function(e,n){const a=n.width,r=n.height,o={r:0,g:0,b:0,a:0},i={value:0},u=4==n.numOutputChannels?1:0,s=n.type==t.FloatType?m:y,c=1==n.dataType?d:f,p=new Uint8Array(n.width*n.height*n.numOutputChannels*n.dataSize),h=new DataView(p.buffer);for(let t=0;t<r;++t)for(let d=0;d<a;++d){const f=t*a*4+4*d,p=s(e,f),y=s(e,f+1),m=s(e,f+2),g=s(e,f+3),v=(r-t-1)*a*(3+u)*n.dataSize;l(o,p,y,m,g),i.value=v+d*n.dataSize,c(h,o.a,i),i.value=v+u*a*n.dataSize+d*n.dataSize,c(h,o.b,i),i.value=v+(1+u)*a*n.dataSize+d*n.dataSize,c(h,o.g,i),i.value=v+(2+u)*a*n.dataSize+d*n.dataSize,c(h,o.r,i)}return p}(o,r),v=function(e,t){let n,a,r=0;const o={data:new Array,totalSize:0},l=t.width*t.numOutputChannels*t.blockLines*t.dataSize;switch(t.compression){case 0:n=i;break;case 2:case 3:n=u}0!==t.compression&&(a=new Uint8Array(l));for(let i=0;i<t.numBlocks;++i){const t=n(e.subarray(l*i,l*(i+1)),a);r+=t.length,o.data.push({dataChunk:t,size:t.length})}return o.totalSize=r,o}(g,r);return function(e,t){const n=8*t.numBlocks,a=259+18*t.numOutputChannels,r={value:a+n},o=new Uint8Array(a+n+e.totalSize+8*t.numBlocks),i=new DataView(o.buffer);!function(e,t,n){const a={value:0},r=new DataView(e.buffer);c(r,20000630,a),c(r,2,a),h(r,"compression",a),h(r,"compression",a),c(r,1,a),s(r,n.compression,a),h(r,"screenWindowCenter",a),h(r,"v2f",a),c(r,8,a),c(r,0,a),c(r,0,a),h(r,"screenWindowWidth",a),h(r,"float",a),c(r,4,a),f(r,1,a),h(r,"pixelAspectRatio",a),h(r,"float",a),c(r,4,a),f(r,1,a),h(r,"lineOrder",a),h(r,"lineOrder",a),c(r,1,a),s(r,0,a),h(r,"dataWindow",a),h(r,"box2i",a),c(r,16,a),c(r,0,a),c(r,0,a),c(r,n.width-1,a),c(r,n.height-1,a),h(r,"displayWindow",a),h(r,"box2i",a),c(r,16,a),c(r,0,a),c(r,0,a),c(r,n.width-1,a),c(r,n.height-1,a),h(r,"channels",a),h(r,"chlist",a),c(r,18*n.numOutputChannels+1,a),h(r,"A",a),c(r,n.dataType,a),a.value+=4,c(r,1,a),c(r,1,a),h(r,"B",a),c(r,n.dataType,a),a.value+=4,c(r,1,a),c(r,1,a),h(r,"G",a),c(r,n.dataType,a),a.value+=4,c(r,1,a),c(r,1,a),h(r,"R",a),c(r,n.dataType,a),a.value+=4,c(r,1,a),c(r,1,a),s(r,0,a),s(r,0,a);let o=a.value+8*n.numBlocks;for(let e=0;e<t.data.length;++e)p(r,o,a),o+=t.data[e].size+8}(o,e,t);for(let n=0;n<e.data.length;++n){const a=e.data[n].dataChunk,u=e.data[n].size;c(i,n*t.blockLines,r),c(i,u,r),o.set(a,r.value),r.value+=u}return o}(v,r)}},e.NO_COMPRESSION=0,e.ZIPS_COMPRESSION=2,e.ZIP_COMPRESSION=3,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("../libs/fflate.module.js")):"function"==typeof define&&define.amd?define(["exports","three","../libs/fflate.module"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE,e.THREE)}();
