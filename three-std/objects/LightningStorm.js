!function(){var i,t;i=this,t=function(i,t,n){"use strict";class s extends t.Object3D{constructor(i={}){super(),this.stormParams=i,i.size=void 0!==i.size?i.size:1e3,i.minHeight=void 0!==i.minHeight?i.minHeight:80,i.maxHeight=void 0!==i.maxHeight?i.maxHeight:100,i.maxSlope=void 0!==i.maxSlope?i.maxSlope:1.1,i.maxLightnings=void 0!==i.maxLightnings?i.maxLightnings:3,i.lightningMinPeriod=void 0!==i.lightningMinPeriod?i.lightningMinPeriod:3,i.lightningMaxPeriod=void 0!==i.lightningMaxPeriod?i.lightningMaxPeriod:7,i.lightningMinDuration=void 0!==i.lightningMinDuration?i.lightningMinDuration:1,i.lightningMaxDuration=void 0!==i.lightningMaxDuration?i.lightningMaxDuration:2.5,this.lightningParameters=n.LightningStrike.copyParameters(i.lightningParameters,i.lightningParameters),this.lightningParameters.isEternal=!1,this.lightningMaterial=void 0!==i.lightningMaterial?i.lightningMaterial:new t.MeshBasicMaterial({color:11599871}),void 0!==i.onRayPosition?this.onRayPosition=i.onRayPosition:this.onRayPosition=function(n,s){s.set((Math.random()-.5)*i.size,0,(Math.random()-.5)*i.size);const e=t.MathUtils.lerp(i.minHeight,i.maxHeight,Math.random());n.set(i.maxSlope*(2*Math.random()-1),1,i.maxSlope*(2*Math.random()-1)).multiplyScalar(e).add(s)},this.onLightningDown=i.onLightningDown,this.inited=!1,this.nextLightningTime=0,this.lightningsMeshes=[],this.deadLightningsMeshes=[];for(let i=0;i<this.stormParams.maxLightnings;i++){const i=new n.LightningStrike(n.LightningStrike.copyParameters({},this.lightningParameters)),s=new t.Mesh(i,this.lightningMaterial);this.deadLightningsMeshes.push(s)}}update(i){if(this.inited||(this.nextLightningTime=this.getNextLightningTime(i)*Math.random(),this.inited=!0),i>=this.nextLightningTime){const s=this.deadLightningsMeshes.pop();if(s){const e=n.LightningStrike.copyParameters(s.geometry.rayParameters,this.lightningParameters);e.birthTime=i,e.deathTime=i+t.MathUtils.lerp(this.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration,Math.random()),this.onRayPosition(e.sourceOffset,e.destOffset),e.noiseSeed=Math.random(),this.add(s),this.lightningsMeshes.push(s)}this.nextLightningTime=this.getNextLightningTime(i)}let s=0,e=this.lightningsMeshes.length;for(;s<e;){const t=this.lightningsMeshes[s],a=t.geometry,h=a.state;a.update(i),h===n.LightningStrike.RAY_PROPAGATING&&a.state>h&&this.onLightningDown&&this.onLightningDown(a),a.state===n.LightningStrike.RAY_EXTINGUISHED?(this.lightningsMeshes.splice(this.lightningsMeshes.indexOf(t),1),this.deadLightningsMeshes.push(t),this.remove(t),e--):s++}}getNextLightningTime(i){return i+t.MathUtils.lerp(this.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod,Math.random())/(this.stormParams.maxLightnings+1)}copy(i){return super.copy(i),this.stormParams.size=i.stormParams.size,this.stormParams.minHeight=i.stormParams.minHeight,this.stormParams.maxHeight=i.stormParams.maxHeight,this.stormParams.maxSlope=i.stormParams.maxSlope,this.stormParams.maxLightnings=i.stormParams.maxLightnings,this.stormParams.lightningMinPeriod=i.stormParams.lightningMinPeriod,this.stormParams.lightningMaxPeriod=i.stormParams.lightningMaxPeriod,this.stormParams.lightningMinDuration=i.stormParams.lightningMinDuration,this.stormParams.lightningMaxDuration=i.stormParams.lightningMaxDuration,this.lightningParameters=n.LightningStrike.copyParameters({},i.lightningParameters),this.lightningMaterial=i.stormParams.lightningMaterial,this.onLightningDown=i.onLightningDown,this}clone(){return new this.constructor(this.stormParams).copy(this)}}s.prototype.isLightningStorm=!0,i.LightningStorm=s,Object.defineProperty(i,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("../geometries/LightningStrike.js")):"function"==typeof define&&define.amd?define(["exports","three","../geometries/LightningStrike"],t):t((i="undefined"!=typeof globalThis?globalThis:i||self).THREE=i["THREE-STD"]||{},i.THREE,i.THREE)}();
