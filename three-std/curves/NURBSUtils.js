!function(){var t,e;t=this,e=function(t,e){"use strict";function o(t,e,o){const n=o.length-t-1;if(e>=o[n])return n-1;if(e<=o[t])return t;let l=t,c=n,r=Math.floor((l+c)/2);for(;e<o[r]||e>=o[r+1];)e<o[r]?c=r:l=r,r=Math.floor((l+c)/2);return r}function n(t,e,o,n){const l=[],c=[],r=[];l[0]=1;for(let f=1;f<=o;++f){c[f]=e-n[t+1-f],r[f]=n[t+f]-e;let o=0;for(let t=0;t<f;++t){const e=r[t+1],n=c[f-t],i=l[t]/(e+n);l[t]=o+e*i,o=n*i}l[f]=o}return l}function l(t,e,o,n,l){const c=[];for(let t=0;t<=o;++t)c[t]=0;const r=[];for(let t=0;t<=n;++t)r[t]=c.slice(0);const f=[];for(let t=0;t<=o;++t)f[t]=c.slice(0);f[0][0]=1;const i=c.slice(0),s=c.slice(0);for(let n=1;n<=o;++n){i[n]=e-l[t+1-n],s[n]=l[t+n]-e;let o=0;for(let t=0;t<n;++t){const e=s[t+1],l=i[n-t];f[n][t]=e+l;const c=f[t][n-1]/f[n][t];f[t][n]=o+e*c,o=l*c}f[n][n]=o}for(let t=0;t<=o;++t)r[0][t]=f[t][o];for(let t=0;t<=o;++t){let e=0,l=1;const i=[];for(let t=0;t<=o;++t)i[t]=c.slice(0);i[0][0]=1;for(let c=1;c<=n;++c){let n=0;const s=t-c,a=o-c;t>=c&&(i[l][0]=i[e][0]/f[a+1][s],n=i[l][0]*f[s][a]);const u=t-1<=a?c-1:o-t;for(let t=s>=-1?1:-s;t<=u;++t)i[l][t]=(i[e][t]-i[e][t-1])/f[a+1][s+t],n+=i[l][t]*f[s+t][a];t<=a&&(i[l][c]=-i[e][c-1]/f[a+1][t],n+=i[l][c]*f[t][a]),r[c][t]=n;const d=e;e=l,l=d}}let a=o;for(let t=1;t<=n;++t){for(let e=0;e<=o;++e)r[t][e]*=a;a*=o-t}return r}function c(t,n,c,r,f){const i=f<t?f:t,s=[],a=o(t,r,n),u=l(a,r,t,i,n),d=[];for(let t=0;t<c.length;++t){const e=c[t].clone(),o=e.w;e.x*=o,e.y*=o,e.z*=o,d[t]=e}for(let e=0;e<=i;++e){const o=d[a-t].clone().multiplyScalar(u[e][0]);for(let n=1;n<=t;++n)o.add(d[a-t+n].clone().multiplyScalar(u[e][n]));s[e]=o}for(let t=i+1;t<=f+1;++t)s[t]=new e.Vector4(0,0,0);return s}function r(t,e){let o=1;for(let e=2;e<=t;++e)o*=e;let n=1;for(let t=2;t<=e;++t)n*=t;for(let o=2;o<=t-e;++o)n*=o;return o/n}function f(t){const o=t.length,n=[],l=[];for(let c=0;c<o;++c){const o=t[c];n[c]=new e.Vector3(o.x,o.y,o.z),l[c]=o.w}const c=[];for(let t=0;t<o;++t){const e=n[t].clone();for(let o=1;o<=t;++o)e.sub(c[t-o].clone().multiplyScalar(r(t,o)*l[o]));c[t]=e.divideScalar(l[0])}return c}t.calcBSplineDerivatives=c,t.calcBSplinePoint=function(t,l,c,r){const f=o(t,r,l),i=n(f,r,t,l),s=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){const o=c[f-t+e],n=i[e],l=o.w*n;s.x+=o.x*l,s.y+=o.y*l,s.z+=o.z*l,s.w+=o.w*n}return s},t.calcBasisFunctionDerivatives=l,t.calcBasisFunctions=n,t.calcKoverI=r,t.calcNURBSDerivatives=function(t,e,o,n,l){return f(c(t,e,o,n,l))},t.calcRationalCurveDerivatives=f,t.calcSurfacePoint=function(t,l,c,r,f,i,s,a){const u=o(t,i,c),d=o(l,s,r),p=n(u,i,t,c),y=n(d,s,l,r),v=[];for(let o=0;o<=l;++o){v[o]=new e.Vector4(0,0,0,0);for(let e=0;e<=t;++e){const n=f[u-t+e][d-l+o].clone(),c=n.w;n.x*=c,n.y*=c,n.z*=c,v[o].add(n.multiplyScalar(p[e]))}}const S=new e.Vector4(0,0,0,0);for(let t=0;t<=l;++t)S.add(v[t].multiplyScalar(y[t]));S.divideScalar(S.w),a.set(S.x,S.y,S.z)},t.findSpan=o,Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).THREE=t["THREE-STD"]||{},t.THREE)}();
