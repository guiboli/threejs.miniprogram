!function(){var e,t;e=this,t=function(e,t,n){"use strict";function r(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var o=r(n);class i extends t.DataTextureLoader{constructor(e){super(e),this.type=t.HalfFloatType}parse(e){const n=65536,r=14,i=65537,a=16384,l=Math.pow(2.7182818,2.2),s={l:0,c:0,lc:0};function c(e,t,n,r,o){for(;n<e;)t=t<<8|H(r,o),n+=8;n-=e,s.l=t>>n&(1<<e)-1,s.c=t,s.lc=n}const u=new Array(59);function f(e,t,n,r,o,a){const l=t;let f=0,h=0;for(;r<=o;r++){if(l.value-t.value>n)return!1;c(6,f,h,e,l);const i=s.l;if(f=s.c,h=s.lc,a[r]=i,63==i){if(l.value-t.value>n)throw new Error("Something wrong with hufUnpackEncTable");c(8,f,h,e,l);let i=s.l+6;if(f=s.c,h=s.lc,r+i>o+1)throw new Error("Something wrong with hufUnpackEncTable");for(;i--;)a[r++]=0;r--}else if(i>=59){let e=i-59+2;if(r+e>o+1)throw new Error("Something wrong with hufUnpackEncTable");for(;e--;)a[r++]=0;r--}}!function(e){for(let e=0;e<=58;++e)u[e]=0;for(let t=0;t<i;++t)u[e[t]]+=1;let t=0;for(let e=58;e>0;--e){const n=t+u[e]>>1;u[e]=t,t=n}for(let t=0;t<i;++t){const n=e[t];n>0&&(e[t]=n|u[n]++<<6)}}(a)}function h(e){return 63&e}function p(e){return e>>6}const w={c:0,lc:0};function d(e,t,n,r){e=e<<8|H(n,r),t+=8,w.c=e,w.lc=t}const y={c:0,lc:0};function v(e,t,n,r,o,i,a,l,s){if(e==t){r<8&&(d(n,r,o,i),n=w.c,r=w.lc);let e=n>>(r-=8);if(e=new Uint8Array([e])[0],l.value+e>s)return!1;const t=a[l.value-1];for(;e-- >0;)a[l.value++]=t}else{if(!(l.value<s))return!1;a[l.value++]=e}y.c=n,y.lc=r}function b(e){return 65535&e}function g(e){const t=b(e);return t>32767?t-65536:t}const S={a:0,b:0};function m(e,t){const n=g(e),r=g(t),o=n+(1&r)+(r>>1),i=o,a=o-r;S.a=i,S.b=a}function E(e,t){const n=b(e),r=b(t),o=n-(r>>1)&65535,i=r+o-32768&65535;S.a=i,S.b=o}function A(e,t,n,r,o,i,a){const l=a<16384,s=n>o?o:n;let c,u,f=1;for(;f<=s;)f<<=1;for(f>>=1,c=f,f>>=1;f>=1;){u=0;const a=u+i*(o-c),s=i*f,h=i*c,p=r*f,w=r*c;let d,y,v,b;for(;u<=a;u+=h){let o=u;const i=u+r*(n-c);for(;o<=i;o+=w){const n=o+p,r=o+s,i=r+p;l?(m(e[o+t],e[r+t]),d=S.a,v=S.b,m(e[n+t],e[i+t]),y=S.a,b=S.b,m(d,y),e[o+t]=S.a,e[n+t]=S.b,m(v,b),e[r+t]=S.a,e[i+t]=S.b):(E(e[o+t],e[r+t]),d=S.a,v=S.b,E(e[n+t],e[i+t]),y=S.a,b=S.b,E(d,y),e[o+t]=S.a,e[n+t]=S.b,E(v,b),e[r+t]=S.a,e[i+t]=S.b)}if(n&f){const n=o+s;l?m(e[o+t],e[n+t]):E(e[o+t],e[n+t]),d=S.a,e[n+t]=S.b,e[o+t]=d}}if(o&f){let o=u;const i=u+r*(n-c);for(;o<=i;o+=w){const n=o+p;l?m(e[o+t],e[n+t]):E(e[o+t],e[n+t]),d=S.a,e[n+t]=S.b,e[o+t]=d}}c=f,f>>=1}return u}function U(e,t,n,o,l,s){const c=n.value,u=B(t,n),b=B(t,n);n.value+=4;const g=B(t,n);if(n.value+=4,u<0||u>=i||b<0||b>=i)throw new Error("Something wrong with HUF_ENCSIZE");const S=new Array(i),m=new Array(a);if(function(e){for(let t=0;t<a;t++)e[t]={},e[t].len=0,e[t].lit=0,e[t].p=null}(m),f(e,n,o-(n.value-c),u,b,S),g>8*(o-(n.value-c)))throw new Error("Something wrong with hufUncompress");!function(e,t,n,o){for(;t<=n;t++){const n=p(e[t]),i=h(e[t]);if(n>>i)throw new Error("Invalid table entry");if(i>r){const e=o[n>>i-r];if(e.len)throw new Error("Invalid table entry");if(e.lit++,e.p){const t=e.p;e.p=new Array(e.lit);for(let n=0;n<e.lit-1;++n)e.p[n]=t[n]}else e.p=new Array(1);e.p[e.lit-1]=t}else if(i){let e=0;for(let a=1<<r-i;a>0;a--){const a=o[(n<<r-i)+e];if(a.len||a.p)throw new Error("Invalid table entry");a.len=i,a.lit=t,e++}}}}(S,u,b,m),function(e,t,n,o,i,a,l,s,c){let u=0,f=0;const b=l,g=Math.trunc(o.value+(i+7)/8);for(;o.value<g;)for(d(u,f,n,o),u=w.c,f=w.lc;f>=r;){const i=t[u>>f-r&16383];if(i.len)f-=i.len,v(i.lit,a,u,f,n,o,s,c,b),u=y.c,f=y.lc;else{if(!i.p)throw new Error("hufDecode issues");let t;for(t=0;t<i.lit;t++){const r=h(e[i.p[t]]);for(;f<r&&o.value<g;)d(u,f,n,o),u=w.c,f=w.lc;if(f>=r&&p(e[i.p[t]])==(u>>f-r&(1<<r)-1)){f-=r,v(i.p[t],a,u,f,n,o,s,c,b),u=y.c,f=y.lc;break}}if(t==i.lit)throw new Error("hufDecode issues")}}const S=8-i&7;for(u>>=S,f-=S;f>0;){const e=t[u<<r-f&16383];if(!e.len)throw new Error("hufDecode issues");f-=e.len,v(e.lit,a,u,f,n,o,s,c,b),u=y.c,f=y.lc}}(S,m,e,n,g,b,s,l,{value:0})}function M(e){for(let t=1;t<e.length;t++){const n=e[t-1]+e[t]-128;e[t]=n}}function R(e,t){let n=0,r=Math.floor((e.length+1)/2),o=0;const i=e.length-1;for(;!(o>i||(t[o++]=e[n++],o>i));)t[o++]=e[r++]}function z(e){let t=e.byteLength;const n=new Array;let r=0;const o=new DataView(e);for(;t>0;){const e=o.getInt8(r++);if(e<0){const i=-e;t-=i+1;for(let e=0;e<i;e++)n.push(o.getUint8(r++))}else{const i=e;t-=2;const a=o.getUint8(r++);for(let e=0;e<i+1;e++)n.push(a)}}return n}function C(e,t,n){let r,o=1;for(;o<64;)r=t[e.value],65280==r?o=64:r>>8==255?o+=255&r:(n[o]=r,o++),e.value++}function O(e,t){t[0]=Y(e[0]),t[1]=Y(e[1]),t[2]=Y(e[5]),t[3]=Y(e[6]),t[4]=Y(e[14]),t[5]=Y(e[15]),t[6]=Y(e[27]),t[7]=Y(e[28]),t[8]=Y(e[2]),t[9]=Y(e[4]),t[10]=Y(e[7]),t[11]=Y(e[13]),t[12]=Y(e[16]),t[13]=Y(e[26]),t[14]=Y(e[29]),t[15]=Y(e[42]),t[16]=Y(e[3]),t[17]=Y(e[8]),t[18]=Y(e[12]),t[19]=Y(e[17]),t[20]=Y(e[25]),t[21]=Y(e[30]),t[22]=Y(e[41]),t[23]=Y(e[43]),t[24]=Y(e[9]),t[25]=Y(e[11]),t[26]=Y(e[18]),t[27]=Y(e[24]),t[28]=Y(e[31]),t[29]=Y(e[40]),t[30]=Y(e[44]),t[31]=Y(e[53]),t[32]=Y(e[10]),t[33]=Y(e[19]),t[34]=Y(e[23]),t[35]=Y(e[32]),t[36]=Y(e[39]),t[37]=Y(e[45]),t[38]=Y(e[52]),t[39]=Y(e[54]),t[40]=Y(e[20]),t[41]=Y(e[22]),t[42]=Y(e[33]),t[43]=Y(e[38]),t[44]=Y(e[46]),t[45]=Y(e[51]),t[46]=Y(e[55]),t[47]=Y(e[60]),t[48]=Y(e[21]),t[49]=Y(e[34]),t[50]=Y(e[37]),t[51]=Y(e[47]),t[52]=Y(e[50]),t[53]=Y(e[56]),t[54]=Y(e[59]),t[55]=Y(e[61]),t[56]=Y(e[35]),t[57]=Y(e[36]),t[58]=Y(e[48]),t[59]=Y(e[49]),t[60]=Y(e[57]),t[61]=Y(e[58]),t[62]=Y(e[62]),t[63]=Y(e[63])}function x(e){const t=.5*Math.cos(.7853975),n=.5*Math.cos(3.14159/16),r=.5*Math.cos(3.14159/8),o=.5*Math.cos(3*3.14159/16),i=.5*Math.cos(.981746875),a=.5*Math.cos(3*3.14159/8),l=.5*Math.cos(1.374445625),s=new Array(4),c=new Array(4),u=new Array(4),f=new Array(4);for(let h=0;h<8;++h){const p=8*h;s[0]=r*e[p+2],s[1]=a*e[p+2],s[2]=r*e[p+6],s[3]=a*e[p+6],c[0]=n*e[p+1]+o*e[p+3]+i*e[p+5]+l*e[p+7],c[1]=o*e[p+1]-l*e[p+3]-n*e[p+5]-i*e[p+7],c[2]=i*e[p+1]-n*e[p+3]+l*e[p+5]+o*e[p+7],c[3]=l*e[p+1]-i*e[p+3]+o*e[p+5]-n*e[p+7],u[0]=t*(e[p+0]+e[p+4]),u[3]=t*(e[p+0]-e[p+4]),u[1]=s[0]+s[3],u[2]=s[1]-s[2],f[0]=u[0]+u[1],f[1]=u[3]+u[2],f[2]=u[3]-u[2],f[3]=u[0]-u[1],e[p+0]=f[0]+c[0],e[p+1]=f[1]+c[1],e[p+2]=f[2]+c[2],e[p+3]=f[3]+c[3],e[p+4]=f[3]-c[3],e[p+5]=f[2]-c[2],e[p+6]=f[1]-c[1],e[p+7]=f[0]-c[0]}for(let h=0;h<8;++h)s[0]=r*e[16+h],s[1]=a*e[16+h],s[2]=r*e[48+h],s[3]=a*e[48+h],c[0]=n*e[8+h]+o*e[24+h]+i*e[40+h]+l*e[56+h],c[1]=o*e[8+h]-l*e[24+h]-n*e[40+h]-i*e[56+h],c[2]=i*e[8+h]-n*e[24+h]+l*e[40+h]+o*e[56+h],c[3]=l*e[8+h]-i*e[24+h]+o*e[40+h]-n*e[56+h],u[0]=t*(e[h]+e[32+h]),u[3]=t*(e[h]-e[32+h]),u[1]=s[0]+s[3],u[2]=s[1]-s[2],f[0]=u[0]+u[1],f[1]=u[3]+u[2],f[2]=u[3]-u[2],f[3]=u[0]-u[1],e[0+h]=f[0]+c[0],e[8+h]=f[1]+c[1],e[16+h]=f[2]+c[2],e[24+h]=f[3]+c[3],e[32+h]=f[3]-c[3],e[40+h]=f[2]-c[2],e[48+h]=f[1]-c[1],e[56+h]=f[0]-c[0]}function I(e){for(let t=0;t<64;++t){const n=e[0][t],r=e[1][t],o=e[2][t];e[0][t]=n+1.5747*o,e[1][t]=n-.1873*r-.4682*o,e[2][t]=n+1.8556*r}}function P(e,n,r){for(let i=0;i<64;++i)n[r+i]=t.DataUtils.toHalfFloat((o=e[i])<=1?Math.sign(o)*Math.pow(Math.abs(o),2.2):Math.sign(o)*Math.pow(l,Math.abs(o)-1));var o}function k(e){return new DataView(e.array.buffer,e.offset.value,e.size)}function T(e){const t=e.viewer.buffer.slice(e.offset.value,e.offset.value+e.size),n=new Uint8Array(z(t)),r=new Uint8Array(n.length);return M(n),R(n,r),new DataView(r.buffer)}function N(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===o&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const n=o.unzlibSync(t),r=new Uint8Array(n.length);return M(n),R(n,r),new DataView(r.buffer)}function D(e){const t=e.viewer,r={value:e.offset.value},o=new Uint16Array(e.width*e.scanlineBlockSize*(e.channels*e.type)),i=new Uint8Array(8192);let a=0;const l=new Array(e.channels);for(let t=0;t<e.channels;t++)l[t]={},l[t].start=a,l[t].end=l[t].start,l[t].nx=e.width,l[t].ny=e.lines,l[t].size=e.type,a+=l[t].nx*l[t].ny*l[t].size;const s=q(t,r),c=q(t,r);if(c>=8192)throw new Error("Something is wrong with PIZ_COMPRESSION BITMAP_SIZE");if(s<=c)for(let e=0;e<c-s+1;e++)i[e+s]=V(t,r);const u=new Uint16Array(n),f=function(e,t){let r=0;for(let o=0;o<n;++o)(0==o||e[o>>3]&1<<(7&o))&&(t[r++]=o);const o=r-1;for(;r<n;)t[r++]=0;return o}(i,u),h=B(t,r);U(e.array,t,r,h,o,a);for(let t=0;t<e.channels;++t){const e=l[t];for(let n=0;n<l[t].size;++n)A(o,e.start+n,e.nx,e.size,e.ny,e.nx*e.size,f)}!function(e,t,n){for(let r=0;r<n;++r)t[r]=e[t[r]]}(u,o,a);let p=0;const w=new Uint8Array(o.buffer.byteLength);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){const e=l[t],n=e.nx*e.size,r=new Uint8Array(o.buffer,2*e.end,2*n);w.set(r,p),p+=2*n,e.end+=n}return new DataView(w.buffer)}function L(e){const t=e.array.slice(e.offset.value,e.offset.value+e.size);void 0===o&&console.error("THREE.EXRLoader: External library fflate.min.js required.");const n=o.unzlibSync(t),r=e.lines*e.channels*e.width,i=1==e.type?new Uint16Array(r):new Uint32Array(r);let a=0,l=0;const s=new Array(4);for(let t=0;t<e.lines;t++)for(let t=0;t<e.channels;t++){let t=0;switch(e.type){case 1:s[0]=a,s[1]=s[0]+e.width,a=s[1]+e.width;for(let r=0;r<e.width;++r)t+=n[s[0]++]<<8|n[s[1]++],i[l]=t,l++;break;case 2:s[0]=a,s[1]=s[0]+e.width,s[2]=s[1]+e.width,a=s[2]+e.width;for(let r=0;r<e.width;++r)t+=n[s[0]++]<<24|n[s[1]++]<<16|n[s[2]++]<<8,i[l]=t,l++}}return new DataView(i.buffer)}function _(e){const t=e.viewer,n={value:e.offset.value},r=new Uint8Array(e.width*e.lines*(e.channels*e.type*2)),i={version:j(t,n),unknownUncompressedSize:j(t,n),unknownCompressedSize:j(t,n),acCompressedSize:j(t,n),dcCompressedSize:j(t,n),rleCompressedSize:j(t,n),rleUncompressedSize:j(t,n),rleRawSize:j(t,n),totalAcUncompressedCount:j(t,n),totalDcUncompressedCount:j(t,n),acCompression:j(t,n)};if(i.version<2)throw new Error("EXRLoader.parse: "+ee.compression+" version "+i.version+" is unsupported");const a=new Array;let l=q(t,n)-2;for(;l>0;){const e=F(t.buffer,n),r=V(t,n),o=r>>2&3,i=new Int8Array([(r>>4)-1])[0],s=V(t,n);a.push({name:e,index:i,type:s,compression:o}),l-=e.length+3}const s=ee.channels,c=new Array(e.channels);for(let t=0;t<e.channels;++t){const n=c[t]={},r=s[t];n.name=r.name,n.compression=0,n.decoded=!1,n.type=r.pixelType,n.pLinear=r.pLinear,n.width=e.width,n.height=e.lines}const u={idx:new Array(3)};for(let t=0;t<e.channels;++t){const e=c[t];for(let n=0;n<a.length;++n){const r=a[n];e.name==r.name&&(e.compression=r.compression,r.index>=0&&(u.idx[r.index]=t),e.offset=t)}}let f,h,p;if(i.acCompressedSize>0)switch(i.acCompression){case 0:f=new Uint16Array(i.totalAcUncompressedCount),U(e.array,t,n,i.acCompressedSize,f,i.totalAcUncompressedCount);break;case 1:const r=e.array.slice(n.value,n.value+i.totalAcUncompressedCount),a=o.unzlibSync(r);f=new Uint16Array(a.buffer),n.value+=i.totalAcUncompressedCount}if(i.dcCompressedSize>0){const t={array:e.array,offset:n,size:i.dcCompressedSize};h=new Uint16Array(N(t).buffer),n.value+=i.dcCompressedSize}if(i.rleRawSize>0){const t=e.array.slice(n.value,n.value+i.rleCompressedSize);p=z(o.unzlibSync(t).buffer),n.value+=i.rleCompressedSize}let w=0;const d=new Array(c.length);for(let e=0;e<d.length;++e)d[e]=new Array;for(let t=0;t<e.lines;++t)for(let t=0;t<c.length;++t)d[t].push(w),w+=c[t].width*e.type*2;!function(e,t,n,r,o,i){let a=new DataView(i.buffer);const l=n[e.idx[0]].width,s=n[e.idx[0]].height,c=Math.floor(l/8),u=Math.ceil(l/8),f=Math.ceil(s/8),h=l-8*(u-1),p=s-8*(f-1),w={value:0},d=new Array(3),y=new Array(3),v=new Array(3),b=new Array(3),g=new Array(3);for(let n=0;n<3;++n)g[n]=t[e.idx[n]],d[n]=n<1?0:d[n-1]+u*f,y[n]=new Float32Array(64),v[n]=new Uint16Array(64),b[n]=new Uint16Array(64*u);for(let t=0;t<f;++t){let i=8;t==f-1&&(i=p);let l=8;for(let e=0;e<u;++e){e==u-1&&(l=h);for(let e=0;e<3;++e)v[e].fill(0),v[e][0]=o[d[e]++],C(w,r,v[e]),O(v[e],y[e]),x(y[e]);I(y);for(let t=0;t<3;++t)P(y[t],b[t],64*e)}let s=0;for(let r=0;r<3;++r){const o=n[e.idx[r]].type;for(let e=8*t;e<8*t+i;++e){s=g[r][e];for(let t=0;t<c;++t){const n=64*t+8*(7&e);a.setUint16(s+0*o,b[r][n+0],!0),a.setUint16(s+2*o,b[r][n+1],!0),a.setUint16(s+4*o,b[r][n+2],!0),a.setUint16(s+6*o,b[r][n+3],!0),a.setUint16(s+8*o,b[r][n+4],!0),a.setUint16(s+10*o,b[r][n+5],!0),a.setUint16(s+12*o,b[r][n+6],!0),a.setUint16(s+14*o,b[r][n+7],!0),s+=16*o}}if(c!=u)for(let e=8*t;e<8*t+i;++e){const t=g[r][e]+8*c*2*o,n=64*c+8*(7&e);for(let e=0;e<l;++e)a.setUint16(t+2*e*o,b[r][n+e],!0)}}}const S=new Uint16Array(l);a=new DataView(i.buffer);for(let t=0;t<3;++t){n[e.idx[t]].decoded=!0;const r=n[e.idx[t]].type;if(2==n[t].type)for(let e=0;e<s;++e){const n=g[t][e];for(let e=0;e<l;++e)S[e]=a.getUint16(n+2*e*r,!0);for(let e=0;e<l;++e)a.setFloat32(n+2*e*r,Y(S[e]),!0)}}}(u,d,c,f,h,r);for(let t=0;t<c.length;++t){const n=c[t];if(!n.decoded){if(2!==n.compression)throw new Error("EXRLoader.parse: unsupported channel compression");{let o=0,i=0;for(let a=0;a<e.lines;++a){let e=d[t][o];for(let t=0;t<n.width;++t){for(let t=0;t<2*n.type;++t)r[e++]=p[i+t*n.width*n.height];i++}o++}}}}return new DataView(r.buffer)}function F(e,t){const n=new Uint8Array(e);let r=0;for(;0!=n[t.value+r];)r+=1;const o=(new TextDecoder).decode(n.slice(t.value,t.value+r));return t.value=t.value+r+1,o}function X(e,t){const n=e.getInt32(t.value,!0);return t.value=t.value+4,n}function B(e,t){const n=e.getUint32(t.value,!0);return t.value=t.value+4,n}function H(e,t){const n=e[t.value];return t.value=t.value+1,n}function V(e,t){const n=e.getUint8(t.value);return t.value=t.value+1,n}const j=function(e,t){let n;return n="getBigInt64"in DataView.prototype?Number(e.getBigInt64(t.value,!0)):e.getUint32(t.value+4,!0)+Number(e.getUint32(t.value,!0)<<32),t.value+=8,n};function W(e,t){const n=e.getFloat32(t.value,!0);return t.value+=4,n}function Z(e,n){return t.DataUtils.toHalfFloat(W(e,n))}function Y(e){const t=(31744&e)>>10,n=1023&e;return(e>>15?-1:1)*(t?31===t?n?NaN:1/0:Math.pow(2,t-15)*(1+n/1024):n/1024*6103515625e-14)}function q(e,t){const n=e.getUint16(t.value,!0);return t.value+=2,n}function G(e,t){return Y(q(e,t))}function $(e,t,n,r,o){return"string"===r||"stringvector"===r||"iccProfile"===r?function(e,t,n){const r=(new TextDecoder).decode(new Uint8Array(e).slice(t.value,t.value+n));return t.value=t.value+n,r}(t,n,o):"chlist"===r?function(e,t,n,r){const o=n.value,i=[];for(;n.value<o+r-1;){const r=F(t,n),o=X(e,n),a=V(e,n);n.value+=3;const l=X(e,n),s=X(e,n);i.push({name:r,pixelType:o,pLinear:a,xSampling:l,ySampling:s})}return n.value+=1,i}(e,t,n,o):"chromaticities"===r?function(e,t){return{redX:W(e,t),redY:W(e,t),greenX:W(e,t),greenY:W(e,t),blueX:W(e,t),blueY:W(e,t),whiteX:W(e,t),whiteY:W(e,t)}}(e,n):"compression"===r?function(e,t){return["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"][V(e,t)]}(e,n):"box2i"===r?function(e,t){return{xMin:B(e,t),yMin:B(e,t),xMax:B(e,t),yMax:B(e,t)}}(e,n):"lineOrder"===r?function(e,t){return["INCREASING_Y"][V(e,t)]}(e,n):"float"===r?W(e,n):"v2f"===r?function(e,t){return[W(e,t),W(e,t)]}(e,n):"v3f"===r?function(e,t){return[W(e,t),W(e,t),W(e,t)]}(e,n):"int"===r?X(e,n):"rational"===r?function(e,t){return[X(e,t),B(e,t)]}(e,n):"timecode"===r?function(e,t){return[B(e,t),B(e,t)]}(e,n):"preview"===r?(n.value+=o,"skipped"):void(n.value+=o)}const J=new DataView(e),K=new Uint8Array(e),Q={value:0},ee=function(e,t,n){const r={};if(20000630!=e.getUint32(0,!0))throw new Error("THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.");r.version=e.getUint8(4);const o=e.getUint8(5);r.spec={singleTile:!!(2&o),longName:!!(4&o),deepFormat:!!(8&o),multiPart:!!(16&o)},n.value=8;let i=!0;for(;i;){const o=F(t,n);if(0==o)i=!1;else{const i=F(t,n),a=$(e,t,n,i,B(e,n));void 0===a?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${i}'.`):r[o]=a}}if(0!=o)throw console.error("EXRHeader:",r),new Error("THREE.EXRLoader: provided file is currently unsupported.");return r}(J,e,Q),te=function(e,n,r,o,i){const a={size:0,viewer:n,array:r,offset:o,width:e.dataWindow.xMax-e.dataWindow.xMin+1,height:e.dataWindow.yMax-e.dataWindow.yMin+1,channels:e.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:e.channels[0].pixelType,uncompress:null,getter:null,format:null,encoding:null};switch(e.compression){case"NO_COMPRESSION":a.lines=1,a.uncompress=k;break;case"RLE_COMPRESSION":a.lines=1,a.uncompress=T;break;case"ZIPS_COMPRESSION":a.lines=1,a.uncompress=N;break;case"ZIP_COMPRESSION":a.lines=16,a.uncompress=N;break;case"PIZ_COMPRESSION":a.lines=32,a.uncompress=D;break;case"PXR24_COMPRESSION":a.lines=16,a.uncompress=L;break;case"DWAA_COMPRESSION":a.lines=32,a.uncompress=_;break;case"DWAB_COMPRESSION":a.lines=256,a.uncompress=_;break;default:throw new Error("EXRLoader.parse: "+e.compression+" is unsupported")}if(a.scanlineBlockSize=a.lines,1==a.type)switch(i){case t.FloatType:a.getter=G,a.inputSize=2;break;case t.HalfFloatType:a.getter=q,a.inputSize=2}else{if(2!=a.type)throw new Error("EXRLoader.parse: unsupported pixelType "+a.type+" for "+e.compression+".");switch(i){case t.FloatType:a.getter=W,a.inputSize=4;break;case t.HalfFloatType:a.getter=Z,a.inputSize=4}}a.blockCount=(e.dataWindow.yMax+1)/a.scanlineBlockSize;for(let e=0;e<a.blockCount;e++)j(n,o);a.outputChannels=3==a.channels?4:a.channels;const l=a.width*a.height*a.outputChannels;switch(i){case t.FloatType:a.byteArray=new Float32Array(l),a.channels<a.outputChannels&&a.byteArray.fill(1,0,l);break;case t.HalfFloatType:a.byteArray=new Uint16Array(l),a.channels<a.outputChannels&&a.byteArray.fill(15360,0,l);break;default:console.error("THREE.EXRLoader: unsupported type: ",i)}return a.bytesPerLine=a.width*a.inputSize*a.channels,4==a.outputChannels?(a.format=t.RGBAFormat,a.encoding=t.LinearEncoding):(a.format=t.RedFormat,a.encoding=t.LinearEncoding),a}(ee,J,K,Q,this.type),ne={value:0},re={R:0,G:1,B:2,A:3,Y:0};for(let e=0;e<te.height/te.scanlineBlockSize;e++){const t=B(J,Q);te.size=B(J,Q),te.lines=t+te.scanlineBlockSize>te.height?te.height-t:te.scanlineBlockSize;const n=te.size<te.lines*te.bytesPerLine?te.uncompress(te):k(te);Q.value+=te.size;for(let t=0;t<te.scanlineBlockSize;t++){const r=t+e*te.scanlineBlockSize;if(r>=te.height)break;for(let e=0;e<te.channels;e++){const o=re[ee.channels[e].name];for(let i=0;i<te.width;i++){ne.value=(t*(te.channels*te.width)+e*te.width+i)*te.inputSize;const a=(te.height-1-r)*(te.width*te.outputChannels)+i*te.outputChannels+o;te.byteArray[a]=te.getter(n,ne)}}}}return{header:ee,width:te.width,height:te.height,data:te.byteArray,format:te.format,encoding:te.encoding,type:this.type}}setDataType(e){return this.type=e,this}load(e,n,r,o){return super.load(e,(function(e,r){e.encoding=r.encoding,e.minFilter=t.LinearFilter,e.magFilter=t.LinearFilter,e.generateMipmaps=!1,e.flipY=!1,n&&n(e,r)}),r,o)}}e.EXRLoader=i,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("../libs/fflate.module.js")):"function"==typeof define&&define.amd?define(["exports","three","../libs/fflate.module"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE,e.THREE)}();
