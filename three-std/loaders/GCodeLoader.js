!function(){var e,t;e=this,t=function(e,t){"use strict";class r extends t.Loader{constructor(e){super(e),this.splitLayer=!1}load(e,r,n,o){const i=this,s=new t.FileLoader(i.manager);s.setPath(i.path),s.setRequestHeader(i.requestHeader),s.setWithCredentials(i.withCredentials),s.load(e,(function(t){try{r(i.parse(t))}catch(t){o?o(t):console.error(t),i.manager.itemError(e)}}),n,o)}parse(e){let r={x:0,y:0,z:0,e:0,f:0,extruding:!1,relative:!1};const n=[];let o;const i=new t.LineBasicMaterial({color:16711680});i.name="path";const s=new t.LineBasicMaterial({color:65280});function a(e){o={vertex:[],pathVertex:[],z:e.z},n.push(o)}function l(e,t){return r.relative?t:t-e}function u(e,t){return r.relative?e+t:t}s.name="extruded";const f=e.replace(/;.+/g,"").split("\n");for(let e=0;e<f.length;e++){const t=f[e].split(" "),n=t[0].toUpperCase(),i={};if(t.splice(1).forEach((function(e){if(void 0!==e[0]){const t=e[0].toLowerCase(),r=parseFloat(e.substring(1));i[t]=r}})),"G0"===n||"G1"===n){const e={x:void 0!==i.x?u(r.x,i.x):r.x,y:void 0!==i.y?u(r.y,i.y):r.y,z:void 0!==i.z?u(r.z,i.z):r.z,e:void 0!==i.e?u(r.e,i.e):r.e,f:void 0!==i.f?u(r.f,i.f):r.f};l(r.e,e.e)>0&&(r.extruding=l(r.e,e.e)>0,null!=o&&e.z==o.z||a(e)),c=r,d=e,void 0===o&&a(c),r.extruding?(o.vertex.push(c.x,c.y,c.z),o.vertex.push(d.x,d.y,d.z)):(o.pathVertex.push(c.x,c.y,c.z),o.pathVertex.push(d.x,d.y,d.z)),r=e}else if("G2"===n||"G3"===n);else if("G90"===n)r.relative=!1;else if("G91"===n)r.relative=!0;else if("G92"===n){const e=r;e.x=void 0!==i.x?i.x:e.x,e.y=void 0!==i.y?i.y:e.y,e.z=void 0!==i.z?i.z:e.z,e.e=void 0!==i.e?i.e:e.e}}var c,d;function p(e,r,n){const o=new t.BufferGeometry;o.setAttribute("position",new t.Float32BufferAttribute(e,3));const a=new t.LineSegments(o,r?s:i);a.name="layer"+n,h.add(a)}const h=new t.Group;if(h.name="gcode",this.splitLayer)for(let e=0;e<n.length;e++){const t=n[e];p(t.vertex,!0,e),p(t.pathVertex,!1,e)}else{const e=[],t=[];for(let r=0;r<n.length;r++){const o=n[r],i=o.vertex,s=o.pathVertex;for(let t=0;t<i.length;t++)e.push(i[t]);for(let e=0;e<s.length;e++)t.push(s[e])}p(e,!0,n.length),p(t,!1,n.length)}return h.quaternion.setFromEuler(new t.Euler(-Math.PI/2,0,0)),h}}e.GCodeLoader=r,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE)}();
