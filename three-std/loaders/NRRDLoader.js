!function(){var e,t;e=this,t=function(e,t,r,n){"use strict";function s(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var a=s(r);class i extends t.Loader{constructor(e){super(e)}load(e,r,n,s){const a=this,i=new t.FileLoader(a.manager);i.setPath(a.path),i.setResponseType("arraybuffer"),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(t){try{r(a.parse(t))}catch(t){s?s(t):console.error(t),a.manager.itemError(e)}}),n,s)}parse(e){let r=e,s=0;const i=new Int8Array(new Int16Array([1]).buffer)[0]>0,c={},u=function(e,t){null==t&&(t=1);let n=1,a=Uint8Array;switch(e){case"uchar":break;case"schar":a=Int8Array;break;case"ushort":a=Uint16Array,n=2;break;case"sshort":a=Int16Array,n=2;break;case"uint":a=Uint32Array,n=4;break;case"sint":a=Int32Array,n=4;break;case"float":a=Float32Array,n=4;break;case"complex":case"double":a=Float64Array,n=8}let o=new a(r.slice(s,s+=t*n));return 1!=i&&(o=function(e,t){const r=new Uint8Array(e.buffer,e.byteOffset,e.byteLength);for(let n=0;n<e.byteLength;n+=t)for(let e=n+t-1,s=n;e>s;e--,s++){const t=r[s];r[s]=r[e],r[e]=t}return e}(o,n)),1==t?o[0]:o}("uchar",e.byteLength),l=u.length;let h,f=null,d=0;for(h=1;h<l;h++)if(10==u[h-1]&&10==u[h]){f=this.parseChars(u,0,h-2),d=h+1;break}if(function(e){let t,r,n,s,a,i,u,l;const h=e.split(/\r?\n/);for(u=0,l=h.length;u<l;u++)a=h[u],a.match(/NRRD\d+/)?c.isNrrd=!0:a.match(/^#/)||(i=a.match(/(.*):(.*)/))&&(r=i[1].trim(),t=i[2].trim(),n=o[r],n?n.call(c,t):c[r]=t);if(!c.isNrrd)throw new Error("Not an NRRD file");if("bz2"===c.encoding||"bzip2"===c.encoding)throw new Error("Bzip is not supported");if(!c.vectors&&(c.vectors=[],c.vectors.push([1,0,0]),c.vectors.push([0,1,0]),c.vectors.push([0,0,1]),c.spacings))for(s=0;s<=2;s++)if(!isNaN(c.spacings[s]))for(let e=0;e<=2;e++)c.vectors[s][e]*=c.spacings[s]}(f),r=u.subarray(d),"gz"===c.encoding.substring(0,2))r=a.gunzipSync(new Uint8Array(r));else if("ascii"===c.encoding||"text"===c.encoding||"txt"===c.encoding||"hex"===c.encoding)r=function(e,t,r){let n,s="";t=t||0,r=r||e.length;const a=c.sizes.reduce((function(e,t){return e*t}),1);let i=10;"hex"===c.encoding&&(i=16);const o=new c.__array(a);let u=0,l=parseInt;c.__array!==Float32Array&&c.__array!==Float64Array||(l=parseFloat);for(let a=t;a<r;a++)n=e[a],(n<9||n>13)&&32!==n?s+=String.fromCharCode(n):(""!==s&&(o[u]=l(s,i),u++),s="");return""!==s&&(o[u]=l(s,i),u++),o}(r);else if("raw"===c.encoding){const e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r[t];r=e}r=r.buffer;const p=new n.Volume;p.header=c,p.data=new c.__array(r);const y=p.computeMinMax(),g=y[0],b=y[1];if(p.windowLow=g,p.windowHigh=b,p.dimensions=[c.sizes[0],c.sizes[1],c.sizes[2]],p.xLength=p.dimensions[0],p.yLength=p.dimensions[1],p.zLength=p.dimensions[2],c.vectors){const e=c.vectors.findIndex((e=>0!==e[0])),t=c.vectors.findIndex((e=>0!==e[1])),r=c.vectors.findIndex((e=>0!==e[2])),n=[];n[e]="x",n[t]="y",n[r]="z",p.axisOrder=n}else p.axisOrder=["x","y","z"];const m=(new t.Vector3).fromArray(c.vectors[0]).length(),w=(new t.Vector3).fromArray(c.vectors[1]).length(),_=(new t.Vector3).fromArray(c.vectors[2]).length();p.spacing=[m,w,_],p.matrix=new t.Matrix4;const x=new t.Matrix4;if("left-posterior-superior"===c.space?x.set(-1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1):"left-anterior-superior"===c.space&&x.set(1,0,0,0,0,1,0,0,0,0,-1,0,0,0,0,1),c.vectors){const e=c.vectors,r=(new t.Matrix4).set(e[0][0],e[1][0],e[2][0],0,e[0][1],e[1][1],e[2][1],0,e[0][2],e[1][2],e[2][2],0,0,0,0,1),n=(new t.Matrix4).multiplyMatrices(r,x);p.matrix=n}else p.matrix.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return p.inverseMatrix=new t.Matrix4,p.inverseMatrix.copy(p.matrix).invert(),p.RASDimensions=new t.Vector3(p.xLength,p.yLength,p.zLength).applyMatrix4(p.matrix).round().toArray().map(Math.abs),p.lowerThreshold===-1/0&&(p.lowerThreshold=g),p.upperThreshold===1/0&&(p.upperThreshold=b),p}parseChars(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);let n="",s=0;for(s=t;s<r;++s)n+=String.fromCharCode(e[s]);return n}}const o={type:function(e){switch(e){case"uchar":case"unsigned char":case"uint8":case"uint8_t":this.__array=Uint8Array;break;case"signed char":case"int8":case"int8_t":this.__array=Int8Array;break;case"short":case"short int":case"signed short":case"signed short int":case"int16":case"int16_t":this.__array=Int16Array;break;case"ushort":case"unsigned short":case"unsigned short int":case"uint16":case"uint16_t":this.__array=Uint16Array;break;case"int":case"signed int":case"int32":case"int32_t":this.__array=Int32Array;break;case"uint":case"unsigned int":case"uint32":case"uint32_t":this.__array=Uint32Array;break;case"float":this.__array=Float32Array;break;case"double":this.__array=Float64Array;break;default:throw new Error("Unsupported NRRD data type: "+e)}return this.type=e},endian:function(e){return this.endian=e},encoding:function(e){return this.encoding=e},dimension:function(e){return this.dim=parseInt(e,10)},sizes:function(e){let t;return this.sizes=function(){const r=e.split(/\s+/),n=[];for(let e=0,s=r.length;e<s;e++)t=r[e],n.push(parseInt(t,10));return n}()},space:function(e){return this.space=e},"space origin":function(e){return this.space_origin=e.split("(")[1].split(")")[0].split(",")},"space directions":function(e){let t,r;const n=e.match(/\(.*?\)/g);return this.vectors=function(){const e=[];for(let s=0,a=n.length;s<a;s++)r=n[s],e.push(function(){const e=r.slice(1,-1).split(/,/),n=[];for(let r=0,s=e.length;r<s;r++)t=e[r],n.push(parseFloat(t));return n}());return e}()},spacings:function(e){let t;const r=e.split(/\s+/);return this.spacings=function(){const e=[];for(let n=0,s=r.length;n<s;n++)t=r[n],e.push(parseFloat(t));return e}()}};e.NRRDLoader=i,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three"),require("../libs/fflate.module.js"),require("../misc/Volume.js")):"function"==typeof define&&define.amd?define(["exports","three","../libs/fflate.module","../misc/Volume"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE,e.THREE,e.THREE)}();
