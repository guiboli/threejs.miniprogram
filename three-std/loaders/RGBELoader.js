!function(){var e,t;e=this,t=function(e,t){"use strict";class r extends t.DataTextureLoader{constructor(e){super(e),this.type=t.HalfFloatType}parse(e){const r=function(e,t){switch(e){case 1:console.error("THREE.RGBELoader Read Error: "+(t||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(t||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(t||""));break;default:console.error("THREE.RGBELoader: Error: "+(t||""))}return-1},a=function(e,t,r){t=t||1024;let a=e.pos,n=-1,o=0,i="",s=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));for(;0>(n=s.indexOf("\n"))&&o<t&&a<e.byteLength;)i+=s,o+=s.length,a+=128,s+=String.fromCharCode.apply(null,new Uint16Array(e.subarray(a,a+128)));return-1<n&&(!1!==r&&(e.pos+=o+n+1),i+s.slice(0,n))},n=function(e,t,r,a){const n=e[t+3],o=Math.pow(2,n-128)/255;r[a+0]=e[t+0]*o,r[a+1]=e[t+1]*o,r[a+2]=e[t+2]*o,r[a+3]=1},o=function(e,r,a,n){const o=e[r+3],i=Math.pow(2,o-128)/255;a[n+0]=t.DataUtils.toHalfFloat(Math.min(e[r+0]*i,65504)),a[n+1]=t.DataUtils.toHalfFloat(Math.min(e[r+1]*i,65504)),a[n+2]=t.DataUtils.toHalfFloat(Math.min(e[r+2]*i,65504)),a[n+3]=t.DataUtils.toHalfFloat(1)},i=new Uint8Array(e);i.pos=0;const s=function(e){const t=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,n=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,o=/^\s*FORMAT=(\S+)\s*$/,i=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,s={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let l,f;if(e.pos>=e.byteLength||!(l=a(e)))return r(1,"no header found");if(!(f=l.match(/^#\?(\S+)/)))return r(3,"bad initial token");for(s.valid|=1,s.programtype=f[1],s.string+=l+"\n";l=a(e),!1!==l;)if(s.string+=l+"\n","#"!==l.charAt(0)){if((f=l.match(t))&&(s.gamma=parseFloat(f[1])),(f=l.match(n))&&(s.exposure=parseFloat(f[1])),(f=l.match(o))&&(s.valid|=2,s.format=f[1]),(f=l.match(i))&&(s.valid|=4,s.height=parseInt(f[1],10),s.width=parseInt(f[2],10)),2&s.valid&&4&s.valid)break}else s.comments+=l+"\n";return 2&s.valid?4&s.valid?s:r(3,"missing image size specifier"):r(3,"missing format specifier")}(i);if(-1!==s){const e=s.width,a=s.height,l=function(e,t,a){const n=t;if(n<8||n>32767||2!==e[0]||2!==e[1]||128&e[2])return new Uint8Array(e);if(n!==(e[2]<<8|e[3]))return r(3,"wrong scanline width");const o=new Uint8Array(4*t*a);if(!o.length)return r(4,"unable to allocate buffer space");let i=0,s=0;const l=4*n,f=new Uint8Array(4),c=new Uint8Array(l);let d=a;for(;d>0&&s<e.byteLength;){if(s+4>e.byteLength)return r(1);if(f[0]=e[s++],f[1]=e[s++],f[2]=e[s++],f[3]=e[s++],2!=f[0]||2!=f[1]||(f[2]<<8|f[3])!=n)return r(3,"bad rgbe scanline format");let t,a=0;for(;a<l&&s<e.byteLength;){t=e[s++];const n=t>128;if(n&&(t-=128),0===t||a+t>l)return r(3,"bad scanline data");if(n){const r=e[s++];for(let e=0;e<t;e++)c[a++]=r}else c.set(e.subarray(s,s+t),a),a+=t,s+=t}const p=n;for(let e=0;e<p;e++){let t=0;o[i]=c[e+t],t+=n,o[i+1]=c[e+t],t+=n,o[i+2]=c[e+t],t+=n,o[i+3]=c[e+t],i+=4}d--}return o}(i.subarray(i.pos),e,a);if(-1!==l){let r,i,f,c;switch(this.type){case t.FloatType:c=l.length/4;const e=new Float32Array(4*c);for(let t=0;t<c;t++)n(l,4*t,e,4*t);r=e,f=t.FloatType;break;case t.HalfFloatType:c=l.length/4;const a=new Uint16Array(4*c);for(let e=0;e<c;e++)o(l,4*e,a,4*e);r=a,f=t.HalfFloatType;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type)}return{width:e,height:a,data:r,header:s.string,gamma:s.gamma,exposure:s.exposure,format:i,type:f}}}return null}setDataType(e){return this.type=e,this}load(e,r,a,n){return super.load(e,(function(e,a){switch(e.type){case t.FloatType:case t.HalfFloatType:e.encoding=t.LinearEncoding,e.minFilter=t.LinearFilter,e.magFilter=t.LinearFilter,e.generateMipmaps=!1,e.flipY=!0}r&&r(e,a)}),a,n)}}e.RGBELoader=r,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE)}();
