!function(){var e,s;e=this,s=function(e,s){"use strict";class t extends s.Loader{constructor(e){super(e),this.debug=!1,this.group=null,this.materials=[],this.meshes=[]}load(e,t,a,i){const r=this,n=""===this.path?s.LoaderUtils.extractUrlBase(e):this.path,d=new s.FileLoader(this.manager);d.setPath(this.path),d.setResponseType("arraybuffer"),d.setRequestHeader(this.requestHeader),d.setWithCredentials(this.withCredentials),d.load(e,(function(s){try{t(r.parse(s,n))}catch(s){i?i(s):console.error(s),r.manager.itemError(e)}}),a,i)}parse(e,t){this.group=new s.Group,this.materials=[],this.meshes=[],this.readFile(e,t);for(let e=0;e<this.meshes.length;e++)this.group.add(this.meshes[e]);return this.group}readFile(e,s){const t=new DataView(e),o=new a(t,0,this.debugMessage);if(o.id===r||o.id===n||o.id===i){let e=o.readChunk();for(;e;){if(e.id===d){const s=e.readDWord();this.debugMessage("3DS file version: "+s)}else e.id===f?this.readMeshData(e,s):this.debugMessage("Unknown main chunk: "+e.hexId);e=o.readChunk()}}this.debugMessage("Parsed "+this.meshes.length+" meshes")}readMeshData(e,s){let t=e.readChunk();for(;t;){if(t.id===p){const e=+t.readDWord();this.debugMessage("Mesh Version: "+e)}else if(t.id===M){const e=t.readFloat();this.debugMessage("Master scale: "+e),this.group.scale.set(e,e,e)}else t.id===v?(this.debugMessage("Named Object"),this.readNamedObject(t)):t.id===b?(this.debugMessage("Material"),this.readMaterialEntry(t,s)):this.debugMessage("Unknown MDATA chunk: "+t.hexId);t=e.readChunk()}}readNamedObject(e){const s=e.readString();let t=e.readChunk();for(;t;){if(t.id===G){const e=this.readMesh(t);e.name=s,this.meshes.push(e)}else this.debugMessage("Unknown named object chunk: "+t.hexId);t=e.readChunk()}}readMaterialEntry(e,t){let a=e.readChunk();const i=new s.MeshPhongMaterial;for(;a;){if(a.id===m)i.name=a.readString(),this.debugMessage("   Name: "+i.name);else if(a.id===B)this.debugMessage("   Wireframe"),i.wireframe=!0;else if(a.id===S){const e=a.readByte();i.wireframeLinewidth=e,this.debugMessage("   Wireframe Thickness: "+e)}else if(a.id===F)i.side=s.DoubleSide,this.debugMessage("   DoubleSided");else if(a.id===W)this.debugMessage("   Additive Blending"),i.blending=s.AdditiveBlending;else if(a.id===y)this.debugMessage("   Diffuse Color"),i.color=this.readColor(a);else if(a.id===C)this.debugMessage("   Specular Color"),i.specular=this.readColor(a);else if(a.id===k)this.debugMessage("   Ambient color"),i.color=this.readColor(a);else if(a.id===w){const e=this.readPercentage(a);i.shininess=100*e,this.debugMessage("   Shininess : "+e)}else if(a.id===x){const e=this.readPercentage(a);i.opacity=1-e,this.debugMessage("  Transparency : "+e),i.transparent=i.opacity<1}else a.id===U?(this.debugMessage("   ColorMap"),i.map=this.readMap(a,t)):a.id===I?(this.debugMessage("   BumpMap"),i.bumpMap=this.readMap(a,t)):a.id===D?(this.debugMessage("   OpacityMap"),i.alphaMap=this.readMap(a,t)):a.id===O?(this.debugMessage("   SpecularMap"),i.specularMap=this.readMap(a,t)):this.debugMessage("   Unknown material chunk: "+a.hexId);a=e.readChunk()}this.materials[i.name]=i}readMesh(e){let t=e.readChunk();const a=new s.BufferGeometry,i=new s.MeshPhongMaterial,r=new s.Mesh(a,i);for(r.name="mesh";t;){if(t.id===L){const e=t.readWord();this.debugMessage("   Vertex: "+e);const i=[];for(let s=0;s<e;s++)i.push(t.readFloat()),i.push(t.readFloat()),i.push(t.readFloat());a.setAttribute("position",new s.Float32BufferAttribute(i,3))}else if(t.id===j)this.readFaceArray(t,r);else if(t.id===H){const e=t.readWord();this.debugMessage("   UV: "+e);const i=[];for(let s=0;s<e;s++)i.push(t.readFloat()),i.push(t.readFloat());a.setAttribute("uv",new s.Float32BufferAttribute(i,2))}else if(t.id===V){this.debugMessage("   Tranformation Matrix (TODO)");const e=[];for(let s=0;s<12;s++)e[s]=t.readFloat();const i=new s.Matrix4;i.elements[0]=e[0],i.elements[1]=e[6],i.elements[2]=e[3],i.elements[3]=e[9],i.elements[4]=e[2],i.elements[5]=e[8],i.elements[6]=e[5],i.elements[7]=e[11],i.elements[8]=e[1],i.elements[9]=e[7],i.elements[10]=e[4],i.elements[11]=e[10],i.elements[12]=0,i.elements[13]=0,i.elements[14]=0,i.elements[15]=1,i.transpose();const n=new s.Matrix4;n.copy(i).invert(),a.applyMatrix4(n),i.decompose(r.position,r.quaternion,r.scale)}else this.debugMessage("   Unknown mesh chunk: "+t.hexId);t=e.readChunk()}return a.computeVertexNormals(),r}readFaceArray(e,s){const t=e.readWord();this.debugMessage("   Faces: "+t);const a=[];for(let s=0;s<t;++s)a.push(e.readWord(),e.readWord(),e.readWord()),e.readWord();s.geometry.setIndex(a);let i=0,r=0;for(;!e.endOfChunk;){const t=e.readChunk();if(t.id===N){this.debugMessage("      Material Group");const e=this.readMaterialGroup(t),a=3*e.index.length;s.geometry.addGroup(r,a,i),r+=a,i++;const n=this.materials[e.name];!1===Array.isArray(s.material)&&(s.material=[]),void 0!==n&&s.material.push(n)}else this.debugMessage("      Unknown face array chunk: "+t.hexId)}1===s.material.length&&(s.material=s.material[0])}readMap(e,t){let a=e.readChunk(),i={};const r=new s.TextureLoader(this.manager);for(r.setPath(this.resourcePath||t).setCrossOrigin(this.crossOrigin);a;){if(a.id===T){const e=a.readString();i=r.load(e),this.debugMessage("      File: "+t+e)}else a.id===E?(i.offset.x=a.readFloat(),this.debugMessage("      OffsetX: "+i.offset.x)):a.id===R?(i.offset.y=a.readFloat(),this.debugMessage("      OffsetY: "+i.offset.y)):a.id===A?(i.repeat.x=a.readFloat(),this.debugMessage("      RepeatX: "+i.repeat.x)):a.id===P?(i.repeat.y=a.readFloat(),this.debugMessage("      RepeatY: "+i.repeat.y)):this.debugMessage("      Unknown map chunk: "+a.hexId);a=e.readChunk()}return i}readMaterialGroup(e){const s=e.readString(),t=e.readWord();this.debugMessage("         Name: "+s),this.debugMessage("         Faces: "+t);const a=[];for(let s=0;s<t;++s)a.push(e.readWord());return{name:s,index:a}}readColor(e){const t=e.readChunk(),a=new s.Color;if(t.id===h||t.id===u){const e=t.readByte(),s=t.readByte(),i=t.readByte();a.setRGB(e/255,s/255,i/255),this.debugMessage("      Color: "+a.r+", "+a.g+", "+a.b)}else if(t.id===o||t.id===l){const e=t.readFloat(),s=t.readFloat(),i=t.readFloat();a.setRGB(e,s,i),this.debugMessage("      Color: "+a.r+", "+a.g+", "+a.b)}else this.debugMessage("      Unknown color chunk: "+t.hexId);return a}readPercentage(e){const s=e.readChunk();switch(s.id){case g:return s.readShort()/100;case c:return s.readFloat();default:return this.debugMessage("      Unknown percentage chunk: "+s.hexId),0}}debugMessage(e){this.debug&&console.log(e)}}class a{constructor(e,s,t){this.data=e,this.offset=s,this.position=s,this.debugMessage=t,this.debugMessage instanceof Function&&(this.debugMessage=function(){}),this.id=this.readWord(),this.size=this.readDWord(),this.end=this.offset+this.size,this.end>e.byteLength&&this.debugMessage("Bad chunk size for chunk at "+s)}readChunk(){if(this.endOfChunk)return null;try{const e=new a(this.data,this.position,this.debugMessage);return this.position+=e.size,e}catch(e){return this.debugMessage("Unable to read chunk at "+this.position),null}}get hexId(){return this.id.toString(16)}get endOfChunk(){return this.position>=this.end}readByte(){const e=this.data.getUint8(this.position,!0);return this.position+=1,e}readFloat(){try{const e=this.data.getFloat32(this.position,!0);return this.position+=4,e}catch(e){return this.debugMessage(e+" "+this.position+" "+this.data.byteLength),0}}readInt(){const e=this.data.getInt32(this.position,!0);return this.position+=4,e}readShort(){const e=this.data.getInt16(this.position,!0);return this.position+=2,e}readDWord(){const e=this.data.getUint32(this.position,!0);return this.position+=4,e}readWord(){const e=this.data.getUint16(this.position,!0);return this.position+=2,e}readString(){let e="",s=this.readByte();for(;s;)e+=String.fromCharCode(s),s=this.readByte();return e}}const i=19789,r=15786,n=49725,d=2,o=16,h=17,u=18,l=19,g=48,c=49,f=15677,p=15678,M=256,b=45055,m=40960,k=40976,y=40992,C=41008,w=41024,x=41040,F=41089,W=41091,B=41093,S=41095,U=41472,D=41488,I=41520,O=41476,T=41728,A=41812,P=41814,E=41816,R=41818,v=16384,G=16640,L=16656,j=16672,N=16688,H=16704,V=16736;e.TDSLoader=t,Object.defineProperty(e,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?s(exports,require("three")):"function"==typeof define&&define.amd?define(["exports","three"],s):s((e="undefined"!=typeof globalThis?globalThis:e||self).THREE=e["THREE-STD"]||{},e.THREE)}();
